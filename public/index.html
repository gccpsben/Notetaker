<html>
    <head>
        <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
        <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
        <script src="./urlJoin.js"></script>
        <script src="./jquery.min.js"></script>
        <script src="editormd/editormd.min.js"></script>
        <script src="./md_english.js"></script>
    </head>
    <body style="margin:0px; background: #222222">
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        
        <div id="app">

            <div v-if="contextMenuTarget != undefined">
                <div v-on:click="contextMenuTarget = undefined" style="position:fixed; width:100%; height:100%; background:#00000001; z-index:98;"></div>
                <div v-if="contextMenuTarget.type == 'note'">
                    <div :style="{'left': contextMenuTarget.x, 'top': contextMenuTarget.y}" style="position:fixed; width:150px; height:500px; background:#222222; z-index:99; border: 1px solid #444444;">
                        <div v-on:click="renameNoteButtonClicked(contextMenuTarget.name)" style="width:100%; height:30px; border-bottom: 1px solid #444444;">
                            <h1 style="font-size:16px; cursor:pointer; color:white; margin:0px; font-weight: 100; margin:10px;">Rename</h1>
                        </div>
                    </div>
                </div>
                <div v-if="contextMenuTarget.type == 'folder'">
                    <div :style="{'left': contextMenuTarget.x, 'top': contextMenuTarget.y}" style="position:fixed; width:150px; height:500px; background:#222222; z-index:99; border: 1px solid #444444;">
                        <div v-on:click="renameFolderButtonClicked(contextMenuTarget.name)" style="width:100%; height:30px; border-bottom: 1px solid #444444;">
                            <h1 style="font-size:16px; cursor:pointer; color:white; margin:0px; font-weight: 100; margin:10px;">Rename</h1>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentPastedMedia != undefined">
                <div v-if="currentPastedMedia.type == 'image'">
                    <div class="maxCenter" style="position:fixed; background:#000000AA; z-index:999;">
                        <div style="width:500px; height:500px; background:#333333; border-radius: 5px; display:grid; grid-template-columns: 1fr; grid-template-rows: 45px 1fr 45px; grid-template-areas: 'top' 'content' 'bottom';">
                            <div class="verticallyCenter" style="grid-area:top; padding:15px;">
                                <h1 style="color:white; margin:0px; padding:0px; font-size:15px; font-weight: 100;">Upload and insert this image?</h1>
                            </div>
                            <div style="grid-area:content; width:100%; background:#222222;">
                                <div :style="{'background-image': `url(${currentPastedMedia.base64})`}" style="width:100%; height:100%; background-size: contain; background-position: center; background-repeat: no-repeat;"></div>
                            </div>
                            <div class="maxCenter" style="grid-area:bottom; width:100%;">
                                <center>
                                    <button v-on:click="uploadMedia(currentPastedMedia)" class="pasteModelConfirmButton">
                                        <span style="color:white; font-size: 20px; transform:translateY(1px)" class="material-icons">done</span>
                                    </button>
                                    <button v-on:click="currentPastedMedia = undefined" class="pasteModelConfirmButton" style="margin:0px;">
                                        <span style="color:white; font-size: 20px; transform:translateY(1px)" class="material-icons">close</span>
                                    </button>
                                </center>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div :style="{'display':isSocketDisconnected? 'none' : 'grid'}" style="grid-template-columns: minmax(300px,0.25fr) 1fr; grid-template-rows:1fr; 
            grid-template-areas: 'left right'; width:100%; height:100%;">

                <div style="margin:0px; grid-area: right; position:relative;">
                    <div v-show="currentNoteName == undefined" class="horiCenter verticallyCenter" style="width:100%; height:100%; background:#222222">
                        <h1 style="font-size:25px; color:#999999; margin:0px; font-weight: 100;">Please Select A Note</h1>
                    </div>
                    <div :style="{'opacity':(currentNoteName ? 1:0)}" style="margin:0px; position:absolute; bottom:0px; top:0px; left:0; right:0;">
                        <iframe id="editorIframe" src="./editor.html" style="border:0px; width:100%; height:100%;"></iframe>
                    </div>
                </div>

                <div class="fullSize" style="margin:0px; grid-area: left; display:grid; grid-template-columns: 1fr; grid-template-rows:42px 42px 1fr 42px; 
                grid-template-areas: 'top' 'search' 'content' 'bottom'; background:#1a1a17;">

                    <div style="grid-area: top; border-bottom:1px solid #333333; position: relative;" class="verticallyCenter horiCenter">
                        <div v-on:click="goUpFolder()" style="position:absolute; left:15px; cursor:pointer;">
                            <span :class="{'materialIconDisabled':currentPath=='/'}" style="user-select: none; color:white; font-size: 20px; transform:translateY(2px)" class="material-icons">chevron_left</span>
                        </div>
                        <h1 class="h1Min">{{currentPathShortName}}</h1>
                        <div style="position:absolute; right:15px; cursor:pointer;">
                            <span v-on:click="createNote()" style="color:white; font-size: 20px; transform:translateY(1px)" class="material-icons">note</span>
                            <span v-on:click="createFolder()" style="color:white; margin-left:15px; font-size: 20px; transform:translateY(1px)" class="material-icons">folder</span>
                        </div>
                    </div>

                    <div style="grid-area: search; border-bottom:1px solid #333333; position: relative;" class="verticallyCenter horiCenter">
                        <div style="width:100%; height:100%; display: grid; grid-template-columns: 50px 1fr; grid-template-rows: 1fr; grid-template-areas: 'left right';">
                            <div class="maxCenter" style="grid-area: left; color:white;">
                                <span style="font-size: 20px; transform:translateY(1px)" class="material-icons">search</span>
                            </div>
                            <input v-model="currentSearchWords" type="text" style=" outline: none; grid-area: right; height:100%; background:transparent; color:white; border:0px;" placeholder="Search for names, tags etc..."></input>
                        </div>
                    </div>

                    <div v-if="!isDirectoryLoading" style="grid-area: content;" id="filesSelectorPanel">
                        <div v-for="note in currentPathNotesFiltered" data-type="note" :data-name="note.name">
                            <div data-type="note" :data-name="note.name" :class="{'currentNote': currentNoteName == note.name, 'noteModified': modifiedNoteNames.includes(note.name) }" v-on:click="openNote(note.name)" class="verticallyCenter noteSelector">
                                <h1 data-type="note" :data-name="note.name" class="h1Min">{{note.name}}</h1>
                            </div>
                        </div>
                        <div v-for="folder in currentPathFoldersFiltered">
                            <div data-type="folder" :data-name="folder.name" v-on:click="openFolder(folder.name)" v-on:click="alert(folder.name)" class="verticallyCenter noteSelector">
                                <div data-type="folder" :data-name="folder.name" style="position:relative; width:100%;">
                                    <h1 data-type="folder" :data-name="folder.name" class="h1Min">{{folder.name}}</h1>
                                    <span data-type="folder" :data-name="folder.name" style="color:white; position:absolute; right:0px; top:0px;" class="material-icons md-dark">chevron_right</span>
                                </div>
                            </div>
                        </div>
                        <div v-if="currentPathFiles.length == 0">
                            <div class="maxCenter">
                                <div>
                                    <center><span style="color:white;" class="material-icons md-dark">book</span></center>
                                    <br>
                                    <h1 class="h1Min">Folder Empty</h1>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-if="isDirectoryLoading" style="grid-area: content; background:#1a1a17;" id="filesSelectorPanel">
                        <div class="maxCenter">
                            <div>
                                <center><div style="color:white;" class="loadingIcon"></div></center>
                                <br>
                                <center><h1 style="font-size:15px; font-weight: 100; color:white;">Loading</h1></center>
                            </div>
                        </div>
                    </div>

                    <div style="grid-area: bottom; background:#1a1a17; border-top:1px solid #333333;" class="verticallyCenter horiCenter">
                        <h1 class="h1Min">BOTTOM</h1>
                    </div>

                </div>
            </div>

            <div v-if="isSocketDisconnected" style="width:100%; height:100%; display:flex; justify-content:center; align-items:center;">
                <div>
                    <h1 style="color:#4e5773; font-weight:100;">Lost Connection...</h1>
                    <center>
                        <button style="border:1px solid #333333; padding:5px; font-size:15px; background:#222222; color:white;">Reconnect</button>
                    </center>
                </div>
            </div>

        </div>

        <script>
        const { createApp } = Vue;

        createApp(
        {
            methods:
            {
                uploadMedia(currentPastedObjectJSON)
                {
                    alert("not done haha");
                },
                renameNote(oldName, newName)
                {
                    var path = urlJoin(this.currentPath, "/");
                    var self = this;
                    
                    fetch("./renameNote", 
                    {
                        method: "POST", headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(
                        {
                            path: path,
                            oldName: oldName,
                            newName: newName,
                            socketIoId: this.socket.io.engine.id
                        })
                    })
                    .then(response => response.text())
                    .then(data => 
                    {
                        //alert(JSON.stringify(data));
                    })
                    .catch((e) => 
                    {
                        alert(e);
                        //self.isSocketDisconnected = true;
                    });
                },
                renameFolder(oldName, newName)
                {
                    var path = urlJoin(this.currentPath, "/");
                    var self = this;
                    
                    fetch("./renameFolder", 
                    {
                        method: "POST", headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(
                        {
                            path: path,
                            oldName: oldName,
                            newName: newName,
                            socketIoId: this.socket.io.engine.id
                        })
                    })
                    .then(response => response.text())
                    .then(data => 
                    {
                        //alert(JSON.stringify(data));
                    })
                    .catch((e) => 
                    {
                        alert(e);
                        //self.isSocketDisconnected = true;
                    });
                },
                updateCurrentDirectoryFiles()
                {
                    var path = urlJoin(this.currentPath, "/");
                    //currentPath = path;
                    var queryURL = `./listDir?path=${path}`;
                    var self = this;
                    
                    this.isDirectoryLoading = true;
                    fetch(queryURL)
                    .then(response => response.text())
                    .then(data => 
                    {
                        setTimeout(() => 
                        {
                            this.currentPathFiles = JSON.parse(data);
                            self.isDirectoryLoading = false;
                        }, 100);
                        //setTimeout(updateFilesSelector, 100);
                    })
                    // there's problem fetching data from server
                    .catch(() => 
                    {
                        self.isSocketDisconnected = true;
                    });
                },
                filterCurrentObjects: function()
                {
                    var term = this.currentSearchWords;
                    return this.currentPathFiles.filter(item => { return item.name.includes(term); });
                },
                urlGoUp: function(url)
                {
                    if (url.endsWith("/")) url = url.substring(0,url.length-1)
                    const lastSlashPosition = url.lastIndexOf("/"); 
                    var output = url.substring(0,lastSlashPosition);
                    if (output == "") output = "/";
                    return output;
                },
                saveNote: function()
                {
                    var self = this;
                    var directory = urlJoin(this.currentWorkingPath, "/")
                    var name = this.currentNoteName;
                    var newContent = $(`#editorIframe`).get(0).contentWindow.editor.getValue();
                    fetch("./updateNote", 
                    {
                        method: "POST",
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            path: directory,
                            name: name,
                            content: newContent,
                            socketIoId: this.socket.io.engine.id
                        })
                    })
                    .then(response => response.text())
                    .then(data => 
                    {
                        console.log(data);
                    })

                    // there's problem fetching data from server
                    .catch(() => 
                    {
                        self.isSocketDisconnected = true;
                    });
                },
                createNote: function ()
                {
                    var suitableName = "";
                    var suitableNameFound = false;
                    var currentCount = 1;
                    while (!suitableNameFound)
                    {
                        var proposedName = `new note ${currentCount}`;
                        if (!this.currentPathFiles.some(item => {  return item.name == proposedName && item.type == "note"  })) 
                        {
                            suitableName = proposedName;
                            suitableNameFound = true;
                        }
                        else { currentCount++; }
                    }
                    
                    var self = this;
                    var directory = urlJoin(this.currentPath, "/")
                    fetch("./createNote", 
                    {
                        method: "POST",
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(
                        {
                            path: directory,
                            name: suitableName,
                            socketIoId: this.socket.io.engine.id
                        })
                    })
                    .then(response => response.text())
                    .then(data => 
                    { 
                        self.updateCurrentDirectoryFiles(); 
                        self.openNote(suitableName);
                    })
                    // there's problem fetching data from server
                    .catch(() => 
                    {
                        self.isSocketDisconnected = true;
                    });
                },
                createFolder: function ()
                {
                    var suitableName = "";
                    var suitableNameFound = false;
                    var currentCount = 1;
                    while (!suitableNameFound)
                    {
                        var proposedName = `new folder ${currentCount}`;
                        if (!this.currentPathFiles.some(item => {  return item.name == proposedName && item.type == "folder"  })) 
                        {
                            suitableName = proposedName;
                            suitableNameFound = true;
                        }
                        else { currentCount++; }
                    }
                    
                    var self = this;
                    var directory = urlJoin(this.currentPath, "/")
                    fetch("./createFolder", 
                    {
                        method: "POST", headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(
                        {
                            path: directory,
                            name: suitableName,
                            socketIoId: this.socket.io.engine.id
                        })
                    })
                    .then(response => response.text())
                    .then(data => 
                    { 
                        self.updateCurrentDirectoryFiles(); 
                    })
                    // there's problem fetching data from server
                    .catch(() => 
                    {
                        self.isSocketDisconnected = true;
                    });
                },
                openNote: function(noteName)
                {
                    this.modifiedNoteNames = this.modifiedNoteNames.filter(i => { return i != noteName });

                    document.title = Math.random();
                    var path = urlJoin(urlJoin(this.currentPath), "/");
                    var queryURL = `./listDir?path=${path}`;
                    var editor = this.editor;
                    var self = this;
                    this.currentNoteName = noteName;
                    this.currentWorkingPath = path;
                    fetch(queryURL)
                    .then(response => response.text())
                    .then(data => 
                    {
                        JSON.parse(data).forEach((object) => 
                        {
                            if (object.name == noteName && object.type == "note")
                            {
                                self.suppressOnChangeEvent = true;
                                $(`#editorIframe`).get(0).contentWindow.editor.setValue(object.content);
                                if (self.suppressOnChangeEventTimeout != undefined) clearTimeout(self.suppressOnChangeEventTimeout);
                                self.suppressOnChangeEventTimeout = setTimeout(() => { self.suppressOnChangeEvent = false; }, 300)

                                // // highlight the note in frontend
                                // $(`#filesSelectorPanel`).children().toArray().forEach(child => 
                                // {
                                //     if (child.dataset.name == noteName) child.classList.add("currentNote");
                                //     else child.classList.remove("currentNote");
                                // });
                            }
                        });
                    })
                    // there's problem fetching data from server
                    .catch(() => 
                    {
                        self.isSocketDisconnected = true;
                    });
                },
                openFolder: function(folderName)
                {
                    //this.currentNoteName = undefined;
                    this.currentPath = urlJoin(urlJoin(this.currentPath, folderName), "/");
                },
                goUpFolder: function()
                {
                    //this.currentNoteName = undefined;
                    this.currentPath = urlJoin(this.urlGoUp(this.currentPath), "/");
                },
                renameNoteButtonClicked: function(oldNoteName)
                {
                    this.contextMenuTarget = undefined; 
                    setTimeout(() => 
                    {
                        var newName = window.prompt('Please enter a new name');
                        if (newName == null) return;
                        this.renameNote(oldNoteName, newName);
                    }, 100);
                },
                renameFolderButtonClicked: function(oldNoteName)
                {
                    this.contextMenuTarget = undefined; 
                    setTimeout(() => 
                    {
                        var newName = window.prompt('Please enter a new name');
                        if (newName == null) return;
                        this.renameFolder(oldNoteName, newName);
                    }, 100);
                },
            },
            computed:
            {
                currentPathNotesFiltered()
                {
                    return this.filterCurrentObjects().filter(i => { return i.type == "note"; });
                },
                currentPathFoldersFiltered()
                {
                    return this.filterCurrentObjects().filter(i => { return i.type == "folder"; });
                },
                currentPathNotes()
                {
                    return this.currentPathFiles.filter(i => { return i.type == "note"; });
                },
                currentPathFolders()
                {
                    return this.currentPathFiles.filter(i => { return i.type == "folder"; });
                },

                // This is the text shown on the navbar, this will only get the last folder in the path, to avoid long path names taking up too many space.
                currentPathShortName()
                {
                    if (this.currentPath == "/") return "All Notes";
                    var t = this.currentPath.split("/");
                    if (t.length == 3) return ("/" + t[t.length - 2] + "/");
                    else return (".../" + t[t.length - 2] + "/");
                }
            },
            watch: 
            {
                currentPath(newPath, oldPath) 
                {
                    this.updateCurrentDirectoryFiles();
                },
                currentPathFiles(newFilesList, oldFilesList)
                {

                }
            },
            data() 
            {
                var d = 
                {
                    currentPath:"", // this path is just the path in the nav view
                    currentWorkingPath:"", // working path is the full directory path of the current editing file
                    currentPathFiles:[],
                    currentNoteName:undefined,
                    editor: undefined,
                    socket: undefined,
                    suppressOnChangeEvent: false,
                    suppressOnChangeEventTimeout: undefined,
                    //inactivityCounter: 0
                    isSocketDisconnected: false,
                    modifiedNoteNames: [],
                    isDirectoryLoading: true,
                    currentSearchWords: "",
                    
                    contextMenuTarget: undefined,
                    window: window,

                    currentPastedMedia: undefined
                }
                return d;
            },
            beforeUpdate()
            {
                var self = this;
                $(`#editorIframe`).get(0).onload = () => 
                {
                    self.editor = $(`#editorIframe`).get(0).contentWindow.editor;
                    $(`#editorIframe`).get(0).contentWindow.editor.on("change", () => 
                    {
                        if (!self.suppressOnChangeEvent)
                        {
                            self.saveNote();
                        }
                    });
                }
            },
            mounted()
            {
                this.socket = io();
                var self = this;

                this.socket.on('connect', function() { self.isSocketDisconnected = false; });
                this.socket.on('disconnect', function() { self.isSocketDisconnected = true; });

                // If the current file is changed by other instances, update the newest content
                this.socket.on("fileChanged", (data) => 
                {
                    // Return if the fileChanged is caused by this client.
                    if (data.socketIdSource == self.socket.io.engine.id) return;
                    if (!self.modifiedNoteNames.includes(data.name)) { self.modifiedNoteNames.push(data.name); }
                    if (data.path == this.currentPath && data.name == this.currentNoteName && data.type == "note")
                    {
                        self.openNote(this.currentNoteName);
                    }
                });

                this.socket.on("directoryChanged", (data) => 
                {
                    // Return if the fileChanged is caused by this client.
                    // if (data.socketIdSource == self.socket.io.engine.id) return;
                    self.updateCurrentDirectoryFiles();
                });

                this.socket.on("noteRenamed", (data) => 
                {
                    // Return if the fileChanged is caused by this client.
                    // if (data.socketIdSource == self.socket.io.engine.id) return;
                    self.updateCurrentDirectoryFiles();

                    if (data.path == self.currentPath && data.oldName == self.currentNoteName)
                    {
                        self.currentNoteName = data.newName;
                    }
                });

                this.socket.on("folderRenamed", (data) => 
                {
                    // Return if the fileChanged is caused by this client.
                    // if (data.socketIdSource == self.socket.io.engine.id) return;
                    self.updateCurrentDirectoryFiles();
                });

                if (document.addEventListener) 
                {
                    document.addEventListener('contextmenu', function(e) 
                    {
                        var selectorContainer = e.target.parentNode;
                        console.log(e);
                        if (selectorContainer.dataset.type != undefined) 
                        { 
                            e.preventDefault();
                            self.contextMenuTarget = 
                            {
                                "type": selectorContainer.dataset.type,
                                "name":  selectorContainer.dataset.name,
                                "x": e.pageX,
                                "y": e.pageY,
                            }
                        }
                    }, false);
                } 

                // Listen for postMessage event coming from the editor iframe when images are pasted.
                window.onmessage = function(e) 
                {
                    if (e.data.name == 'imagePasted') 
                    {
                        self.currentPastedMedia = 
                        {
                            "type": "image",
                            "base64": e.data.base64
                        };
                    }
                };

                // this.editor = editormd("test-editor", 
                // {
                //     path : "editormd/lib/",
                //     width  : "calc(100% - 2px)",
                //     autoHeight : true,
                //     theme: "dark",
                //     previewTheme: "dark",
                //     editorTheme: "pastel-on-dark",
                //     // onchange: () =>
                //     // { 
                //     //     console.log(this);
                //     //     this.saveNote(urlJoin(currentPath, "/"), currentNoteName, editor.getValue()); 
                //     // }
                //     // onchange: this.saveNote
                // });   

                this.currentPath = "/";                
            },
        }).mount('#app')
        </script>

        <style>
        * { transition: 0; }
        .currentNote { background:#333; }
        .fullSize { width: 100%; height:100%; }
        .h1Min { margin:0px; padding:0px; color:white; font-size:16px; font-weight:100; }
        .verticallyCenter { display:flex; align-items: center; }
        .horiCenter { display:flex; justify-content: center; }
        .noteSelector { height: 50px; border-bottom:1px solid #333333; padding-left:30px; padding-right:20px; transition: all 0.1s ease; position:relative; }
        .noteSelector:hover { border-bottom:1px solid #333333; background: #555555; cursor:pointer; transition: all 0.1s ease; }
        .editormd-toolbar { border-bottom: 1px solid #333333 !important; border-left: 1px solid #333333 !important; }
        .materialIconDisabled { opacity: 0.3; cursor:not-allowed; }
        .noteModified { border-right: 1px solid orange !important; }
        .maxCenter { display:flex; width:100%; height:100%; justify-content: center; align-items: center; }
        .loadingIcon 
        {
            animation: loadingIcon 2s infinite linear;
            height: 32px;
            width: 32px;
            background: url("loadingIcon.png");
            background-size: contain;
        }
        .pasteModelConfirmButton 
        { 
            background: rgb(34, 34, 34); border: 0px none; margin-right: 15px;padding: 4px 10px 4px 10px; 
            border:1px #333333 solid; border-radius: 3px;
        }
        .pasteModelConfirmButton:hover
        { 
            background: #444444; cursor: pointer;
        }
        @keyframes loadingIcon
        {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        </style>

        <script type="text/javascript">

        // var editor = editormd("test-editor", 
        // {
        //     path : "editormd/lib/",
        //     width  : "calc(100% - 2px)",
        //     autoHeight : true,
        //     theme: "dark",
        //     previewTheme: "dark",
        //     editorTheme: "pastel-on-dark",
        //     onchange: function () 
        //     {
        //         saveNote(urlJoin(currentPath, "/"), currentNoteName, editor.getValue());
        //     }
        // });    

        // setTimeout(function () 
        // {
        //     editor.toolbarIcons[10].style.display = "none"
        //     editor.toolbarIcons[11].style.display = "none"
        //     editor.toolbarIcons[12].style.display = "none"
        //     editor.toolbarIcons[13].style.display = "none"
        //     editor.toolbarIcons[14].style.display = "none"
        //     editor.settings.taskList = true;
        //     // //editor.previewing();
        // }, 1000);

        // goToFolder("/");

        // function saveNote(directory, name, newContent)
        // {
        //     fetch("./updateNote", 
        //     {
        //         method: "POST",
        //         headers: { 'Content-Type': 'application/json' },
        //         body: JSON.stringify({
        //             path: directory,
        //             name: name,
        //             content: newContent
        //         })
        //     })
        //     .then(response => response.text())
        //     .then(data => 
        //     {
        //         console.log(data);
        //     });
        // }

        // function updateFilesSelector()
        // {
        //     $(`#filesSelectorPanel`).empty();
        //     currentPathFiles.forEach(object => 
        //     {
        //         if (object.type == "note")
        //         {
        //             $(`#filesSelectorPanel`).append(
        //             `
        //                 <div data-name="${object.name}" onclick="openNote('${object.name}')" class="verticallyCenter noteSelector">
        //                     <h1 class="h1Min">${object.name}</h1>
        //                 </div>
        //             `);
        //         }
        //         else if (object.type == "folder")
        //         {
        //             $(`#filesSelectorPanel`).append(
        //             `
        //                 <div data-name="${object.name}" onclick="goToFolder('${object.name}')" class="verticallyCenter noteSelector">
        //                     <div style="position:relative; width:100%;">
        //                         <h1 class="h1Min">${object.name}</h1>
        //                         <span style="color:white; position:absolute; right:0px; top:0px;" class="material-icons md-dark">chevron_right</span>
        //                     </div>
        //                 </div>
        //             `);
        //         }
        //     });
        // }

        // function openNote(noteName)
        // {
        //     var path = urlJoin(urlJoin(currentPath), "/");
        //     var queryURL = `./listDir?path=${path}`;
            
        //     fetch(queryURL)
        //     .then(response => response.text())
        //     .then(data => 
        //     {
        //         console.log(data);
        //         JSON.parse(data).forEach((object) => 
        //         {
        //             if (object.name == noteName && object.type == "note")
        //             {
        //                 editor.setValue(object.content)
        //                 currentNoteName = noteName;

        //                 // highlight the note in frontend
        //                 $(`#filesSelectorPanel`).children().toArray().forEach(child => 
        //                 {
        //                     if (child.dataset.name == noteName) child.classList.add("currentNote");
        //                     else child.classList.remove("currentNote");
        //                 });
        //             }
        //         });
        //     });
        // }

        // function goToFolder(relativePath)
        // {
        //     var path = urlJoin(urlJoin(currentPath, relativePath), "/");
        //     currentPath = path;
        //     var queryURL = `./listDir?path=${path}`;
            
        //     fetch(queryURL)
        //     .then(response => response.text())
        //     .then(data => 
        //     {
        //         console.log(data);
        //         currentPathFiles = JSON.parse(data);
        //         setTimeout(updateFilesSelector, 100);
        //     });
        // }

        </script>
    </body>
</html>